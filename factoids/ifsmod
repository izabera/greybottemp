IFS side-effects reference: https://gist.github.com/ormaaj/4465894